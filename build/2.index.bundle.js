webpackJsonp([2],{4:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){var e=$(document),t=void 0,a="0",n=moment().format("YYYY-MM-DD HH:mm:ss"),o=void 0;if(window.openDatabase){var r=openDatabase("my_acess_db","1.0","My access db",5242880);console.log("Success to open database")}else new Promise(function(e){i.e(0).then(function(t){e(i(0))}.bind(null,i)).catch(i.oe)}).then(function(e){e.default()});var c="ASC";$(".icon-login").hide(),$(".nav-btn").fadeIn(500),$(".nav-disconnect").fadeIn(500);!function(){window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var e=new RTCPeerConnection({iceServers:[]}),t=function(){};e.createDataChannel(""),e.createOffer(e.setLocalDescription.bind(e),t),e.onicecandidate=function(i){if(i&&i.candidate&&i.candidate.candidate)return o=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(i.candidate.candidate)[1],e.onicecandidate=t,o}}();var d,s=function(e,t){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||void 0===t?"<br />":"<br>")+"$2")},l=function(e){$("#add_img_loaded").html('<img src="'+e.target.result+'"/>')},p=function(e,t){var i,a,n,o,r,c,d,s="default.png";if(e.length>=1&&t.files&&t.files[0]){var l=t.files[0],p=l.path,u=l.name,f=l.type;l.size,"image/png"!=f&&"image/jpeg"!=f||(i=fs,a=path,n=p,o="./upload/",r=a.basename(n),c=i.createReadStream(n),d=i.createWriteStream(a.resolve(o,r)),c.pipe(d),c.on("end",function(){console.log("Succesfully copied")}),c.on("error",function(e){console.log(e)}),s=u)}return s},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ASC";!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ASC";r.transaction(function(t){t.executeSql("SELECT rowid, * FROM category ORDER BY position "+e,[],function(e,t){if(t.rows){var i=t.rows;$(i).each(function(e,t){var i='<div data-id="'+t.rowid+'" data-position="'+t.position+'" class="view-category"><div class="title-block"><div data-id="'+t.rowid+'" class="category-hide"><i class="fa fa-angle-down" aria-hidden="true"></i></div><div class="img-category"><img src="/upload/'+t.img+'"></div><div class="title-category">'+t.title+'</div></div><div data-id="'+t.rowid+'" class="category-view-item"></div>';$("#view_data").prepend(i),$('.category-hide[data-id="'+t.rowid+'"]').children("i").css("transform","rotate(45deg)")})}})})}(),setTimeout(function(){window.openDatabase?openDatabase("my_acess_db","1.0","My access db",5242880).transaction(function(i){i.executeSql("SELECT rowid, * FROM datas ORDER BY position "+t,[],function(t,i){if(i.rows){var a=i.rows;$(a).each(function(e,i){var a=i.description;if("1"===i.encrypted)t.executeSql("SELECT key FROM encryption",[],function(e,t){if(t.rows[0]){var n=t.rows[0].key;a=(a=CryptoJS.AES.decrypt(i.description,n)).toString(CryptoJS.enc.Utf8);var r='<div data-id="'+i.rowid+'" data-position="'+i.position+'" class="view-item keyword_data"><div class="nav-item"><div data-id="'+i.rowid+'" class="hide-item"><i class="fa fa-angle-down" aria-hidden="true"></i></div><div class="title-item">'+i.title+'</div><div data-id="'+i.rowid+'" class="grip-notice">Drag me..</div><div data-id="'+i.rowid+'" class="grip"><i class="fa fa-paw" aria-hidden="true"></i></div><div class="btn-nav"><i data-id="'+i.rowid+'" class="fa fa-trash view_item_delete" aria-hidden="true"></i></div><div class="btn-nav"><i data-id="'+i.rowid+'" class="fa fa-pencil view_item_edit" aria-hidden="true"></i></div></div><div data-id="'+i.rowid+'" class="item-delete-confirmation"><div class="item_confirm_delete">DELETE</div><div class="item_cancel_delete">CANCEL</div></div><div data-id="'+i.rowid+'" class="description-item"><div class="img"><img src="/upload/'+i.img+'" alt="" /></div><div class="text">'+a+'</div></div><div class="date-item"><div class="item-encrypt">Encrypted..</div><div class="item-position">'+o+'</div><div class="date-up">Updated : '+i.dateupdate+"</div></div></div>";"0"!=i.category&&$('.category-view-item[data-id="'+i.category+'"]').is(":visible")?($('.category-view-item[data-id="'+i.category+'"]').append(r),console.log(i.category)):$("#view_data").append(r)}});else{var n='<div data-id="'+i.rowid+'" data-position="'+i.position+'" class="view-item keyword_data"><div class="nav-item"><div data-id="'+i.rowid+'" class="hide-item"><i class="fa fa-angle-down" aria-hidden="true"></i></div><div class="title-item">'+i.title+'</div><div data-id="'+i.rowid+'" class="grip-notice">Drag me..</div><div data-id="'+i.rowid+'" class="grip"><i class="fa fa-paw" aria-hidden="true"></i></div><div class="btn-nav"><i data-id="'+i.rowid+'" class="fa fa-trash view_item_delete" aria-hidden="true"></i></div><div class="btn-nav"><i data-id="'+i.rowid+'" class="fa fa-pencil view_item_edit" aria-hidden="true"></i></div></div><div data-id="'+i.rowid+'" class="item-delete-confirmation"><div class="item_confirm_delete">DELETE</div><div class="item_cancel_delete">CANCEL</div></div><div data-id="'+i.rowid+'" class="description-item"><div class="img"><img src="/upload/'+i.img+'" alt="" /></div><div class="text">'+a+'</div></div><div class="date-item"><div class="item-encrypt">Not encrypted..</div><div class="item-position">'+o+'</div><div class="date-up">Updated : '+i.dateupdate+"</div></div></div>";"0"!=i.category&&$('.category-view-item[data-id="'+i.category+'"]').is(":visible")?($('.category-view-item[data-id="'+i.category+'"]').append(n),console.log(i.category)):$("#view_data").append(n)}var o=e+1;t.executeSql("UPDATE datas SET position=? WHERE rowid=?",[e,i.rowid])}),$("#view_data").sortable({items:".view-item",handle:".grip",connectWith:".category-view-item",opacity:.5,axis:"y",revert:!0,stop:function(e,t){if(window.openDatabase){var i=openDatabase("my_acess_db","1.0","My access db",5242880);$(".view-item").each(function(e,t){var a=e+1;$(t).attr("data-position",e);var n=$(t).attr("data-id");$(t).find(".item-position").text(a),i.transaction(function(t){t.executeSql("UPDATE datas SET position=? WHERE rowid=?",[e,n])})})}}}),jQuery.expr[":"].icontains=function(e,t,i){var a=$(e).text(),n=i[3];return $.each([{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}],function(){a=a.replace(this.re,this.ch),n=n.replace(this.re,this.ch)}),a.toUpperCase().indexOf(n.toUpperCase())>=0},e.off("keyup","#item_filter_keywords").on("keyup","#item_filter_keywords",function(){var e=$(this).val();e.length>=2?($(".keyword_data").hide(),$('.keyword_data:icontains("'+e+'")').show()):$(".keyword_data").show()}),setTimeout(function(){$(".category-view-item").droppable({accept:".view-item",over:function(e,t){console.log("over"),$(e.target).addClass("dropped")},drop:function(e,t){console.log("drop");var i=$(e.target).attr("data-id"),a=$(t.draggable[0]).clone();$(t.draggable[0]).addClass("ToRemove");var n=$(t.draggable[0]).attr("data-id");$(a).insertBefore(".ui-sortable-placeholder"),$(a).removeAttr("style"),$(".ToRemove").remove(),$(".category-view-item").removeClass("dropped"),r.transaction(function(e){e.executeSql("UPDATE datas SET category=? WHERE rowid=?",[i,n]),console.log("category updated")})},out:function(e,t){console.log("out");var i=$(t.draggable[0]).attr("data-id");r.transaction(function(e){e.executeSql("UPDATE datas SET category=? WHERE rowid=?",["0",i]),console.log("out updated")})}})},2e3)}})}):new Promise(function(e){i.e(0).then(function(t){e(i(0))}.bind(null,i)).catch(i.oe)}).then(function(e){e.default()})},500)},f=function(e){var t=new $.Deferred;return r.readTransaction(function(i){i.executeSql("SELECT * FROM "+e,[],function(e,i){var a=i.rows;t.resolve(a)})},null),t},m=function(){var e=new $.Deferred;return r.transaction(function(t){t.executeSql("SELECT * FROM synchronize",[],function(t,i){i?e.resolve(i.rows[0].key):e.resolve("null")})},function(t){console.log("no database"),e.resolve("null")}),e},_=function(){r.transaction(function(e){var t=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<50;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}();e.executeSql("CREATE TABLE IF NOT EXISTS synchronize (key, active, datestart DATETIME)"),console.log("synchronize table created"),e.executeSql('INSERT INTO synchronize (key, active, datestart) VALUES ("'+t+'", "1", "'+n+'")'),console.log("data insered in synchronize table"),e.executeSql("CREATE TABLE IF NOT EXISTS synchronize_autorized (key, ip, machine, dateadd DATETIME)"),console.log("synchronize_autorized table created"),e.executeSql("CREATE TABLE IF NOT EXISTS synchronize_log (ip, key, datelog DATETIME)"),console.log("synchronize_log table created")},function(e){console.log(e)})};d=null,$.when(m()).then(function(e){"null"!=e&&(d=e,setTimeout(function(){http_server_start(o,d)},1500))});var v=function(e){var t=new $.Deferred;return r.readTransaction(function(i){i.executeSql("SELECT * FROM datas WHERE title=?",[e],function(e,i){if(i){var a=i.rows;t.resolve(a)}else t="no_data"})},function(e){console.log(e)}),t},h=function(e){var t=e.title,i=e.description,a=e.dateadd,n=e.dateupdate,o=e.encrypted;r.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS datas (title, description LONGTEXT, img, position, dateadd DATETIME, dateupdate DATETIME, encrypted VARCHAR NOT NULL DEFAULT '0')"),e.executeSql('INSERT INTO datas (title, description, img, position, dateadd, dateupdate, encrypted) VALUES ("'+t+'", "'+i+'", "default.png", "0", "'+a+'", "'+n+'", "'+o+'")')})},g=function(e){r.transaction(function(t){"1"===e&&(t.executeSql("UPDATE encryption SET state=? where rowid=?",["1",1]),t.executeSql("SELECT key FROM encryption",[],function(e,t){if(t.rows[0]){var i=t.rows[0].key;y(i)}})),"0"===e&&(t.executeSql("UPDATE encryption SET state=? where rowid=?",["0",1]),t.executeSql("SELECT key FROM encryption",[],function(e,t){if(t.rows[0]){var i=t.rows[0].key;w(i)}}))})},y=function(e){r.transaction(function(t){t.executeSql("SELECT rowid, * FROM datas",[],function(t,i){i&&$.each(i.rows,function(i,a){var n=CryptoJS.AES.encrypt(a.description,e);n=n.toString();var o=a.rowid;"0"===a.encrypted&&(t.executeSql("UPDATE datas SET description=? where rowid=?",[n,o]),t.executeSql("UPDATE datas SET encrypted=? where rowid=?",["1",o]))})})}),console.log("crypt data")},w=function(e){r.transaction(function(t){t.executeSql("SELECT rowid, * FROM datas",[],function(t,i){i&&$.each(i.rows,function(i,a){var n=CryptoJS.AES.decrypt(a.description,e);n=n.toString(CryptoJS.enc.Utf8);var o=a.rowid;"1"===a.encrypted&&(t.executeSql("UPDATE datas SET description=? where rowid=?",[n,o]),t.executeSql("UPDATE datas SET encrypted=? where rowid=?",["0",o]))})})}),console.log("decrypt data")},E=function(){var e=path.basename("/data")+"/datas.json";fs.exists(e,function(t){t&&($("#result_export_database_file").show(),fs.readFile(e,"utf8",function(e,t){if(!e){var i="text/json;charset=utf-8,"+encodeURIComponent(t);$('<a href="data:'+i+'" download="datas.json">Download JSON file</a>').appendTo("#result_export_database_file")}}))})};r.transaction(function(e){e.executeSql("SELECT encrypted FROM datas",[],function(e,t){console.log(t)})},function(e){console.log(e),"could not prepare statement (1 no such column: encrypted)"===e.message&&r.transaction(function(e){e.executeSql("ALTER TABLE datas ADD encrypted VARCHAR NOT NULL DEFAULT '0' ")})}),r.transaction(function(e){e.executeSql("SELECT category FROM datas",[],function(e,t){console.log(t)})},function(e){console.log(e),"could not prepare statement (1 no such column: category)"===e.message&&r.transaction(function(e){e.executeSql("ALTER TABLE datas ADD category VARCHAR NOT NULL DEFAULT '0' ")})}),r.transaction(function(e){e.executeSql("SELECT state FROM encryption",[],function(e,t){console.log(t)})},function(e){console.log(e),"could not prepare statement (1 no such column: state)"===e.message&&r.transaction(function(e){e.executeSql("ALTER TABLE encryption ADD state VARCHAR NOT NULL DEFAULT '0' ")})}),$("#app_nav").show(),r.transaction(function(e){console.log("Select user info"),e.executeSql("SELECT * FROM user",[],function(e,i){if(i.rows[0]){var n=i.rows[0];n.login,t=n.email,a=n.remember}})}),$.post("/templates/view.html",function(e){console.log("Template View loaded"),$("#template_load").html(e),u(c)}),e.off("click","#return_home").on("click","#return_home",function(){$.post("/templates/view.html",function(e){$("#template_load").html(e),u(c)})}),e.off("click","#show_params").on("click","#show_params",function(){$.post("/templates/params.html",function(e){$("#template_load").html(e);var i,n=null;$.when(m(),(i=new $.Deferred,r.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS encryption (key, state VARCHAR NOT NULL DEFAULT '0')"),e.executeSql("SELECT rowid, * FROM encryption",[],function(e,t){t.rows[0]?i.resolve(t.rows[0]):i.resolve("null")})},function(e){console.log("no database"),i.resolve("null")}),i)).then(function(e,i){"null"!=e&&(n=e,$("#open_browser_localhost").fadeIn(300),$("#load_link_for_sync").html("http://"+o+":3000/"+n),$("#a_link_share_sync").attr("href","mailto:?subject=The link for share my access. Remove this email after sync app...&&cc="+t+"&body=http://"+o+":3000/"+n),$('input[name="http_server"]').prop("checked",!0)),"null"==i&&null==i||($("#params_encryption").val(i.key),$("#params_encrypt_data_state").show(),"1"===i.state?($("input#encrypt_data").prop("checked",!0),$("#params_encryption").prop("readonly",!0),$("#params_encryption").prop("disabled",!0)):($("input#encrypt_data").prop("checked",!1),$("#params_encryption").prop("readonly",!1),$("#params_encryption").prop("disabled",!1)))}),"1"===a?$('input[name="params_remember"]').prop("checked",!0):$('input[name="params_remember"]').prop("checked",!1),E(),$("#get_api_for_synchronize_result_html").remove()})}),e.off("click","#add_data").on("click","#add_data",function(){$.post("/templates/add.html",function(e){$("#template_load").html(e)})}),e.off("click","#add_category").on("click","#add_category",function(){$.post("/templates/add_category.html",function(e){$("#template_load").html(e)})}),e.off("click","#app_return").on("click","#app_return",function(){$.post("/templates/view.html",function(e){$("#template_load").html(e),add_navigation()})}),e.off("click","#app_disconnect").on("click","#app_disconnect",function(){r.transaction(function(e){e.executeSql("SELECT * FROM user",[],function(e,t){e.executeSql("UPDATE user SET remember=? where rowid=?",["0",1],function(e){new Promise(function(e){i.e(1).then(function(t){e(i(3))}.bind(null,i)).catch(i.oe)}).then(function(e){e.default()})})})})}),e.off("change",'input[name="http_server"]').on("change",'input[name="http_server"]',function(){var e=null;1==$(this).prop("checked")?($.when(m()).then(function(i){"null"!=i?(e=i,$("#open_browser_localhost").fadeIn(300),$("#load_link_for_sync").html("http://"+o+":3000/"+e),$("#a_link_share_sync").attr("href","mailto:?subject=The link for share my access app&&cc="+t+"&body=http://"+o+":3000/"+e)):(_(),$.when(m()).then(function(i){e=i,$("#open_browser_localhost").fadeIn(300),$("#load_link_for_sync").html("http://"+o+":3000/"+e),$("#a_link_share_sync").attr("href","mailto:?subject=The link for share my access app&&cc="+t+"&body=http://"+o+":3000/"+e)}))}),setTimeout(function(){win_reload()},1500)):($("#open_browser_localhost").fadeOut(300),$("#sync_key_show").remove(),r.transaction(function(e){e.executeSql("DROP TABLE synchronize",[],function(e,t){console.log("Successfully Dropped synchronize")},function(e,t){console.log("Could not delete synchronize")}),e.executeSql("DROP TABLE synchronize_autorized",[],function(e,t){console.log("Successfully Dropped synchronize_autorized")},function(e,t){console.log("Could not delete synchronize_autorized")}),e.executeSql("DROP TABLE synchronize_log",[],function(e,t){console.log("Successfully Dropped synchronize_log")},function(e,t){console.log("Could not delete synchronize_log")})}),setTimeout(function(){win_reload()},1e3))}),e.off("change",'input[name="params_remember"]').on("change",'input[name="params_remember"]',function(){var e=$(this).prop("checked");r.transaction(function(t){t.executeSql("SELECT * FROM user",[],function(t,i){1==e?(t.executeSql("UPDATE user SET remember=? where rowid=?",["1",1]),a="1"):(t.executeSql("UPDATE user SET remember=? where rowid=?",["0",1]),a="0")})})}),e.off("change",'input[name="export_database"]').on("change",'input[name="export_database"]',function(){1==$(this).prop("checked")&&$.when(f("datas"),f("user")).then(function(e,t){if(e.length>=1){$('input[name="export_database"]').hide(),$("#result_export_database").fadeIn(300).append("<small>Data succesfully exported</small>");var i={datas:e},a=JSON.stringify(i);fs.writeFile("data/datas.json",a,function(e){e?console.error(e):($('input[name="export_database"]').prop("checked",!1),$("#result_export_database_file").is(":hidden")&&E())})}if(t.length>=1){$('input[name="export_database"]').hide(),$("#result_export_database").fadeIn(300).append("<small>User succesfully exported</small>");var n={user:t};JSON.stringify(n)}setTimeout(function(){$("#result_export_database").fadeOut(300).html(""),$('input[name="export_database"]').show(300)},3e3)})}),e.off("click","#get_api_for_synchronize").on("click","#get_api_for_synchronize",function(e){e.preventDefault();var t=$("#api_for_synchronize").val();$("#get_api_for_synchronize_result_html").remove(),t.length>=25?$.getJSON(t,function(e){if(e){var t=e.datas;$.each(t,function(e,t){var i=t.title;$.when(v(i)).then(function(e){e.length<=0?(h(t),console.log("item insered.."),$("#get_api_for_synchronize_result").html('<div id="get_api_for_synchronize_result_html">'+i+" insered..</div>")):(console.log("item allready on database.."),$("#get_api_for_synchronize_result").html('<div id="get_api_for_synchronize_result_html">All items are allready on database..</div>'))})})}}):0===t.length?($("#api_for_synchronize").val("Enter link in field.."),setTimeout(function(){$("#api_for_synchronize").val(t)},2e3)):($("#api_for_synchronize").val("Link is not valid..."),setTimeout(function(){$("#api_for_synchronize").val(t)},2e3))}),e.off("click","#send_params_encryption").on("click","#send_params_encryption",function(e){e.preventDefault();var t,i=$("#params_encryption").val();i.length>=8?(t=i,r.transaction(function(e){e.executeSql("SELECT * FROM encryption",[],function(e,i){console.log(i),i.rows[0]?(console.log("update"),e.executeSql("UPDATE encryption SET key=? where rowid=?",[t,1])):e.executeSql('INSERT INTO encryption (key) VALUES ("'+t+'")'),console.log(i)})}),$("#params_encryption_result").html('<div id="params_encryption_result_html">Added !</div>'),setTimeout(function(){$("#params_encryption_result_html").remove()},1500)):($("#params_encryption").val("8 print minimum required.."),setTimeout(function(){$("#params_encryption").val(i)},2e3))}),e.off("change",'input[name="encrypt_data"]').on("change",'input[name="encrypt_data"]',function(){1==$(this).prop("checked")?(g("1"),$("#params_encryption").prop("readonly",!0),$("#params_encryption").prop("disabled",!0),$("#encrypt_data_result").html('<div id="encrypt_data_result_html">Crypted !</div>'),setTimeout(function(){$("#encrypt_data_result_html").remove()},1500)):(g("0"),$("#params_encryption").prop("readonly",!1),$("#params_encryption").prop("disabled",!1),$("#encrypt_data_result").html('<div id="encrypt_data_result_html">Decrypted !</div>'),setTimeout(function(){$("#encrypt_data_result_html").remove()},1500))}),e.off("change",'input[name="import_database"]').on("change",'input[name="import_database"]',function(){var e=$(this).val();fs.readFile(e,"utf8",function(e,t){if(e)console.log(e);else{var i=$.parseJSON(t).datas;$.each(i,function(e,t){var i=t.title;$.when(v(i)).then(function(e){e.length<=0?(h(t),$("#result_import_database").text(t.title+" insered in database..").show()):$("#result_import_database").text("All items are allready on database..").show()})})}})}),e.off("change",'input[name="add_img"]').on("change",'input[name="add_img"]',function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=l,e.readAsDataURL(this.files[0])}}),e.off("submit","#form_add_data").on("submit","#form_add_data",function(e){e.preventDefault();var t=$('input[name="add_title"]').val(),i=s($('textarea[name="add_description"]').val());if(t.length>=1&&i.length>=1){var a=$('input[name="add_img"]').val(),o=$('input[name="add_img"]')[0],d=p(a,o);r.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS datas (title, description LONGTEXT, img, position, dateadd DATETIME, dateupdate DATETIME, encrypted VARCHAR NOT NULL DEFAULT '0', category VARCHAR NOT NULL DEFAULT '0')"),e.executeSql("SELECT key FROM encryption",[],function(e,a){if(a.rows[0]){var o=a.rows[0].key,r=CryptoJS.AES.encrypt(i,o);r=r.toString(),e.executeSql('INSERT INTO datas (title, description, img, dateadd, dateupdate, encrypted, category) VALUES ("'+t+'", "'+r+'", "'+d+'", "'+n+'", "'+n+'", "1", "0")')}else e.executeSql('INSERT INTO datas (title, description, img, dateadd, dateupdate, encrypted, category) VALUES ("'+t+'", "'+i+'", "'+d+'", "'+n+'", "'+n+'", "0", "0")')}),$('input[name="add_title"]').val(""),$('textarea[name="add_description"]').val(""),$('file[name="add_img"]').val(""),$.post("/templates/view.html",function(e){$("#template_load").html(e),u(c)})})}else t.length<=0&&($('input[name="add_title"]').val("this field is empty.."),setTimeout(function(){$('input[name="add_title"]').val(t)},2e3)),i.length<=0&&($('textarea[name="add_description"]').val("this field is empty.."),setTimeout(function(){$('textarea[name="add_description"]').val(i)},2e3))}),e.off("change",'input[name="add_category_img"]').on("change",'input[name="add_category_img"]',function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=l,e.readAsDataURL(this.files[0])}}),e.off("submit","#form_add_category").on("submit","#form_add_category",function(e){e.preventDefault();var t=$('input[name="add_category_title"]').val(),i=s($('textarea[name="add_category_description"]').val());if(t.length>=1&&i.length>=1){var a=$('input[name="add_category_img"]').val(),o=$('input[name="add_category_img"]')[0],d=p(a,o);r.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS category (title, description LONGTEXT, img, position, dateadd DATETIME, dateupdate DATETIME)"),e.executeSql('INSERT INTO category (title, description, img, dateadd, dateupdate) VALUES ("'+t+'", "'+i+'", "'+d+'", "'+n+'", "'+n+'")'),$('input[name="add_category_title"]').val(""),$('textarea[name="add_category_description"]').val(""),$('file[name="add_category_img"]').val(""),$.post("/templates/view.html",function(e){$("#template_load").html(e),u(c)})})}else t.length<=0&&($('input[name="add_category_title"]').val("this field is empty.."),setTimeout(function(){$('input[name="add_category_title"]').val(t)},2e3)),i.length<=0&&($('textarea[name="add_category_description"]').val("this field is empty.."),setTimeout(function(){$('textarea[name="add_category_description"]').val(i)},2e3))}),e.off("change",'input[name="edit_img"]').on("change",'input[name="edit_img"]',function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=l,e.readAsDataURL(this.files[0])}}),e.off("click",".view_item_edit").on("click",".view_item_edit",function(){var e=$(this).attr("data-id");$.post("/templates/edit.html",function(t){$("#template_load").html(t),r.transaction(function(t){t.executeSql("SELECT * FROM datas WHERE rowid=?",[e],function(t,i){if(i.rows){var a=i.rows[0];if("1"===a.encrypted)t.executeSql("SELECT key FROM encryption",[],function(e,t){if(t.rows[0]){var i=t.rows[0].key,n=a.description,o=CryptoJS.AES.decrypt(n,i);n=(o=o.toString(CryptoJS.enc.Utf8)).replace(/<br\s*\/?>/gi,""),$('textarea[name="edit_description"]').val(n),$('input[name="encrypt_state"]').val("1")}});else{var n=a.description;n=n.replace(/<br\s*\/?>/gi,""),$('textarea[name="edit_description"]').val(n),$('input[name="encrypt_state"]').val("0")}$('input[name="row_id"]').val(e),$('input[name="edit_title"]').val(a.title),$("#add_img_loaded").html('<img src="/upload/'+a.img+'"/>')}})})})}),e.off("submit","#form_edit_data").on("submit","#form_edit_data",function(e){e.preventDefault();var t=$('input[name="row_id"]').val(),i=$('input[name="edit_title"]').val(),a=s($('textarea[name="edit_description"]').val()),n=$('input[name="encrypt_state"]').val();if(i.length>=1&&a.length>=1){var o=moment().format("YYYY-MM-DD HH:mm:ss"),d=$('input[name="edit_img"]').val(),l=$('input[name="edit_img"]')[0],f=p(d,l);r.transaction(function(e){"1"===n?e.executeSql("SELECT key FROM encryption",[],function(e,n){if(n.rows[0]){var r=n.rows[0].key,c=CryptoJS.AES.encrypt(a,r);c=c.toString(),"default.png"!=f?e.executeSql("UPDATE datas SET title=?, description=?, img=?, dateupdate=? WHERE rowid=?",[i,c,f,o,t]):e.executeSql("UPDATE datas SET title=?, description=?, dateupdate=? WHERE rowid=?",[i,c,o,t])}}):"default.png"!=f?e.executeSql("UPDATE datas SET title=?, description=?, img=?, dateupdate=? WHERE rowid=?",[i,a,f,o,t]):e.executeSql("UPDATE datas SET title=?, description=?, dateupdate=? WHERE rowid=?",[i,a,o,t]),$.post("/templates/view.html",function(e){$("#template_load").html(e),u(c)})})}else i.length<=0&&($('input[name="add_title"]').val("this field is empty.."),setTimeout(function(){$('input[name="add_title"]').val(i)},2e3)),a.length<=0&&($('textarea[name="add_description"]').val("this field is empty.."),setTimeout(function(){$('textarea[name="add_description"]').val(a)},2e3))}),e.off("click",".view_item_delete").on("click",".view_item_delete",function(){var e=$(this).attr("data-id");$('.item-delete-confirmation[data-id="'+e+'"]').fadeIn(300)}),e.off("click",".item_confirm_delete").on("click",".item_confirm_delete",function(){var e=$(this).parent(".item-delete-confirmation").attr("data-id");r.transaction(function(t){t.executeSql("DELETE FROM datas WHERE rowid=?",[e]),$("#view_data").html(""),u(c)})}),e.off("click",".item_cancel_delete").on("click",".item_cancel_delete",function(){var e=$(this).parent(".item-delete-confirmation").attr("data-id");$('.item-delete-confirmation[data-id="'+e+'"]').fadeOut(300)}),e.off("click",".category-hide").on("click",".category-hide",function(){var e=$(this).attr("data-id");$('.category-view-item[data-id="'+e+'"]').is(":visible")?$(this).children("i").css("transform","rotate(0deg)"):$(this).children("i").css("transform","rotate(45deg)"),$('.category-view-item[data-id="'+e+'"]').slideToggle(300)}),e.off("click",".hide-item").on("click",".hide-item",function(){var e=$(this).attr("data-id");$('.description-item[data-id="'+e+'"]').is(":visible")?$(this).children("i").css("transform","rotate(0deg)"):$(this).children("i").css("transform","rotate(45deg)"),$('.description-item[data-id="'+e+'"]').slideToggle(300)}),e.off("click",".view_show_all_description").on("click",".view_show_all_description",function(){$(".view-item").is(":visible")&&($(this).hide(),$(".view_hide_all_description").show(),$(".description-item").slideDown(300))}),e.off("click",".view_hide_all_description").on("click",".view_hide_all_description",function(){$(".view-item").is(":visible")&&($(this).hide(),$(".view_show_all_description").show(),$(".description-item").slideUp(300))}),e.off("click",".view_hide_all_item").on("click",".view_hide_all_item",function(){$(".view-item").is(":visible")&&($(this).hide(),$(".view_show_all_item").show(),$(".view-item").css("opacity","0"),$(".secret-img").fadeIn(300))}),e.off("click",".view_show_all_item").on("click",".view_show_all_item",function(){$(".view-item").is(":visible")&&($(this).hide(),$(".view_hide_all_item").show(),$(".view-item").css("opacity","1"),$(".secret-img").fadeOut(300))}),e.off("mouseenter",".grip").on("mouseenter",".grip",function(){var e=$(this).attr("data-id");$('.grip-notice[data-id="'+e+'"]').fadeIn(300)}),e.off("mouseleave",".grip, .view-item").on("mouseleave",".grip, .view-item",function(){var e=$(this).attr("data-id");$('.grip-notice[data-id="'+e+'"]').fadeOut(300)})}}});